{% extends "base.html" %} {% block title %}Home{% endblock %} {% block content
  %}
<div class="container px-0 my-5">
  <h3 class="text-white">< {{ weekday }} - {{ current_date }} ></h3>
  <div class="container text-center">
    <div class="row align-items-center">
      <!--YESTERDAY VALUES-->
      <div class="col">
        <h5 class="text-white text-start">Yesterday</h5>
        <div class="dropdown ms-auto">
          <button
            class="btn btn-secondary dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Utilities
          </button>
          <ul class="dropdown-menu">
            <li>
              <a
                class="dropdown-item"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#addTaskModal"
              >
                Add
              </a>
            </li>
            <li><a class="dropdown-item" href="#">Delete</a></li>
          </ul>
        </div>
        <div class="col">
          <div class="card text-bg-dark mb-3 mx-4" style="max-width: 18rem">
            <div class="card-body">
              <div class="card-text">
                {% for task in yesterday_tasks %}
                <li class="list-group-item">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="checkDefault{{ task.id }}"
                      {% if task.completed %} checked {% endif %}
                      onchange="toggleTask({{ task.id }}, this.checked)"
                    />
                    <label class="form-check-label" for="checkDefault{{ task.id }}">{{ task.name }}</label>
                  </div>
                </li>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--TODAY VALUES-->
      <div class="col">
        <h5 class="text-white text-start">Today</h5>
        <div class="dropdown ms-auto">
          <button
            class="btn btn-secondary dropdown-toggle"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            Utilities
          </button>
          <ul class="dropdown-menu">
            <li>
              <a
                class="dropdown-item"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#addTaskModal"
              >
                Add
              </a>
            </li>
            <li><a class="dropdown-item" href="#">Delete</a></li>
          </ul>
        </div>
        <div class="col">
          <div class="card text-bg-dark mb-3 mx-4" style="max-width: 18rem">
            <div class="card-body">
              <div class="card-text">
                <!--TODAY VALUES-->
                {% for task in today_tasks %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="checkDefault{{ task.id }}"
                          {% if task.completed %} checked {% endif %}
                          onchange="toggleTask({{ task.id }}, this.checked)">
                    <label class="form-check-label" for="checkDefault{{ task.id }}">{{ task.name }}</label>
                  </div>
                  <button 
                    type="button" 
                    class="btn badge rounded-pill text-bg-secondary align-content-end"
                    data-bs-toggle="modal"
                    data-bs-target="#EditTaskModal{{task.id}}">
                      
                    Edit
                  </button>
                </li>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!--Add-Task-Modal-->
  <div
    class="modal fade"
    id="addTaskModal"
    tabindex="-1"
    aria-labelledby="addTaskModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg rounded-3">
        <div class="modal-header">
          <h5 class="modal-title" id="addTaskModalLabel">Add Task</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form action="{{ url_for('add') }}" method="post">
            <div class="mb-3">
              <label for="name" class="form-label">Task Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                required
              />
            </div>

            <div class="mb-3">
              <label for="type" class="form-label">Task Type</label>
              <select class="form-select" id="type" name="type" required>
                {% for t in types %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-3">
              <label for="day" class="form-label">Day</label>
              <input
                type="text"
                class="form-control"
                id="day"
                name="day"
                value="{{ next_day_value }}"
                readonly
              />
            </div>

            <div class="mb-3">
              <label for="value" class="form-label">Value</label>
              <input
                type="number"
                class="form-control"
                id="value"
                name="value"
                value="{{ next_value }}"
                readonly
              />
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">Add Task</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!--Edit-Task-Modal-->
  {% for task in today_tasks %}
  <div
    class="modal fade"
    id="EditTaskModal{{ task.id }}"
    tabindex="-1"
    aria-labelledby="EditTaskModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg rounded-3">
        <div class="modal-header">
          <h5 class="modal-title" id="EditTaskModalLabel">Edit Task</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form action="{{ url_for('edit') }}" method="post">
            <input type="hidden" name="id" value="{{ task.id }}">

            <div class="mb-3">
              <label for="name" class="form-label">Task Name</label>
              <input
                type="text"
                class="form-control"
                id="name{{task.id}}"
                name="name"
                value="{{task.name}}"
                required
              />
            </div>

            <div class="mb-3">
              <label for="type" class="form-label">Task Type</label>
              <select class="form-select" id="type" name="type" required>
                {% for t in types %}
                  <option value="{{ t }}">{{ t }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="day" class="form-label">Day</label>
              <input
                type="text"
                class="form-control"
                id="day{{task.id}}"
                name="day"
                value="{{ task.day if task else next_day_value }}"
                readonly
              />
            </div>

            <div class="mb-3">
              <label for="value" class="form-label">Value</label>
              <input
                type="number"
                step="1"
                class="form-control"
                id="value{{task.id}}"
                name="value"
                value="{{task.value}}"
                required
              />
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">Edit Task</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}

</div>
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
<script>
function toggleTask(taskId, isChecked) {
    fetch(`/toggle_task/${taskId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ completed: isChecked })
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) alert('Error updating task');
    })
    .catch(err => alert('Error updating task'));
}
</script>

{% endblock %}
 </div>
</div>
